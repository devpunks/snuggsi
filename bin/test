#!/usr/bin/env bash

# https://gist.github.com/branneman/8775568
# https://gist.github.com/branneman/8048520
# https://stackoverflow.com/questions/10265798/determine-project-root-from-a-running-node-js-application

export PORT=8181
export ROOT=$(pwd)
export API="element"
export NODE_PATH=$ROOT
export ENTRY="index.test"
export TEST="$ROOT/node_modules/.bin/tape"
export SPEC="$ROOT/node_modules/.bin/tap-spec"
export LIBRARIES=".,test,server,resource,middleware"
export TESTS=$ROOT/${1:-"{$LIBRARIES,$API}/$ENTRY"}

echo
echo "⚠️ Testing $TESTS"
echo

$TEST          \
  --require ./ \
  -- $TESTS    \
  |  $SPEC
