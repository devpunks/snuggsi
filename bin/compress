#!/usr/bin/env bash

# https://github.com/google/zopfli
declare -r \
  DIST=./dist \
  ZOPFLI='zopfli -v -i1' \
  BROTLI='brotli --verbose --best'
# bro is installed locally and manually. No npm cli. HELP!

declare -ar \
  FILES=( snuggsi.min.es snuggsi.min.js )

echo -e "  ğŸŒ±  Compressing â€¦"

for file in ${FILES[@]} ; do
  declare path=${DIST}/${file}

  echo "   ğŸŒ¿  $path"

  echo "     ğŸƒ  Brotli ğŸ‘‰  ${path}.br"
  $BROTLI --stdout \
    $path > $path.br

  # https://www.ietf.org/rfc/rfc1951.txt
  echo "     ğŸ‚  DEFLATE ğŸ‘‰  $path.deflate"
  $ZOPFLI --deflate $path

  # https://www.ietf.org/rfc/rfc1950.txt
  echo "     â˜˜ï¸  ZLIB ğŸ‘‰  ${path}.zlib"
  $ZOPFLI --zlib $path

  # https://www.ietf.org/rfc/rfc1952.txt
  echo "     ğŸ€  GZIP ğŸ‘‰  ${path}.gz"
  $ZOPFLI --gzip $path

  echo
done

