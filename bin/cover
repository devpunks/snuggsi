#!/bin/bash

export COVER="node_modules/.bin/nyc" # Coverage runner
export THRESHOLD=95                 # Represented in Percentage
export INCLUDE="resource"           # Included coverage files
export EXCLUDE="**/node_modules/**" # Excluded coverage files
export EXTENSION=".es"              # Extension for coverage files
export OUTPUT=".nyc_output/"        # Represented in Percentage


$COVER                    \
  --include=$INCLUDE      \
  --exclude=$EXCLUDE      \
  --extension=$EXTENSION  \
  --reporter=text         \
  bin/test


echo
echo # NYC Test coverage
echo "ðŸ“Š  snuggsi ãƒ„ Coverage Repoort"
echo "  ðŸŽ¯  Threshold ðŸ‘‰  $THRESHOLD %"
echo "  âž•  Included  ðŸ‘‰  $INCLUDE"
echo "  âž–  Excluded  ðŸ‘‰  $EXCLUDE"
echo

$COVER                       \
  check-coverage             \
    --lines      $THRESHOLD  \
    --functions  $THRESHOLD  \
    --statements $THRESHOLD  \
  bin/test


export CODE=$?

echo
echo "ðŸš®  Post Coverage Cleanup of $OUTPUT"
rm -rf .nyc_output/ # Remove output directory


exit $CODE
