#!/usr/bin/env bash

set -u

# ${SNUGGSI?"ğŸ”´ Set shell variable to installation location"}

declare -r  THRESHOLD=100                        # Percentage
declare -r  EXTENSIONS='.es'                     # Ecmascript
declare -r  HARNESS="node --test index.test.es **/*.test.*"    # Test harness
declare -r  OUTPUT=.nyc_output/                  # Represented in Percentage
declare -r  REPORTER=text                        # Type of coverage report to generate
declare -r  COVER=$SNUGGSI/node_modules/.bin/nyc # Coverage runner
declare -r  CHECK="$COVER --check-coverage"      # Coverage checker
declare -r  EXCLUDE='{middleware,resource,server}/**' # + test(s) & node_modules
declare -r  LIBRARIES='./watch/*.es'

echo "ğŸ“Š  snuggsi ãƒ„ Coverage Report"
echo
echo "  ğŸ¯  Threshold ğŸ‘‰  $THRESHOLD %"
echo "  âš™ï¸   Cover     ğŸ‘‰  $COVER"
echo "  â•  Included  ğŸ‘‰  $LIBRARIES"
echo "  â–  Excluded  ğŸ‘‰  $EXCLUDE"
echo

# --all
# --show-process-tree
# --include $LIBRARIES
$CHECK \
  --exclude    $EXCLUDE    \
  --lines      $THRESHOLD  \
  --branches   $THRESHOLD  \
  --functions  $THRESHOLD  \
  --statements $THRESHOLD  \
  --clean --per-file       \
  --exclude-node-modules   \
  --extension  $EXTENSIONS \
  $HARNESS


declare -r  CODE=$?

# echo
# echo "ğŸ“  Coverage Cleanup"
# echo " âš ï¸  Removing coverage report artifacts."
# echo " ğŸ‘‡ "
# echo "  ğŸš®  Removing ğŸ‘‰  $OUTPUT"

# echo # Remove output directory
# rm -rf $OUTPUT

exit $CODE

