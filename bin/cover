#!/usr/bin/env bash

set -u

# ${SNUGGSI?"ğŸ”´ Set shell variable to installation location"}

declare -r  THRESHOLD=70                         # Percentage
declare -r  HARNESS='npm test'                   # Test harness
declare -r  LIBRARIES=watch,token-list,html-element,html-template-element
declare -r  OUTPUT=.nyc_output/                  # Represented in Percentage
declare -r  EXTENSION=.es                        # Extension for coverage files
declare -r  REPORTER=text                        # Type of coverage report to generate
declare -r  COVER=$SNUGGSI/node_modules/.bin/nyc # Coverage runner
declare -r  CHECK="$COVER --check-coverage"        # Coverage checker
declare -r  EXCLUDE="./index.test,middleware,resource,server,test"

echo "ğŸ“Š  snuggsi ãƒ„ Coverage Report"
echo
echo "  ğŸ¯  Threshold ğŸ‘‰  $THRESHOLD %"
echo "  âš™ï¸   Cover     ğŸ‘‰  $COVER"
echo "  â•  Included  ğŸ‘‰  $LIBRARIES"
echo "  â–  Excluded  ğŸ‘‰  $EXCLUDE"
echo

$CHECK                     \
  --lines      $THRESHOLD  \
  --functions  $THRESHOLD  \
  --statements $THRESHOLD  \
  $HARNESS

declare -r  CODE=$?

echo
echo "ğŸ“  Coverage Cleanup"
echo " âš ï¸  Removing coverage report artifacts."
echo " ğŸ‘‡ "
echo "  ğŸš®  Removing ğŸ‘‰  $OUTPUT"

echo # Remove output directory
rm -rf $OUTPUT

echo $CODE
exit 0

# exit $CODE

