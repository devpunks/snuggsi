#!/usr/bin/env bash

# Environment variable vs. Shell Variable
#   - https://askubuntu.com/questions/26318/environment-variable-vs-shell-variable-whats-the-difference

# Shell Parameter Expansion
#  - https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html

# Bash string manipulations
#  - http://www.tldp.org/LDP/LG/issue18/bash.html
#  - https://stackoverflow.com/questions/6393551/what-is-the-meaning-of-0-in-a-bash-script

echo
echo "  ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ "
echo "  ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„                  ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ "
echo "  ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„    snuggsi ãƒ„    ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ "
echo "  ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„                  ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ "
echo "  ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ "
echo

function node_path { # npm bin -g
  local \
    path=${NODE_PATH:-`npm config get prefix | awk NR==1`/lib/node_modules}

  echo $path
}

function run {
  local \
    executable=$1

  if test ${executable##*/} == snuggsi \
  || test ! -f $executable
    then
      echo "ğŸ”´  Invalid command \`${executable##*/}\`"
      ${executable%\/*}/help
      exit 1
  fi

  echo "ğŸ“š  MOUNTING RESOURCES â€¦"
  printf '    ğŸ“  %s\n' "${resources[@]}"
  echo

  for resource in "${ARGUMENTS[@]:-. }" # Default o curren directory
    do
      if test -d $resource
        then
          echo " ğŸ‘‰  ğŸ“‚  $resource â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          $executable $resource
        else
          echo "ğŸ”´  $resource RESOURCE DIRECTORY NOT FOUND !"
      fi
    done
}

declare -rx  \
  NODE_PATH=`node_path`
declare -rx \
  SNUGGSI=${NODE_PATH}/${BASH_SOURCE##*/} # Absolute path to snuggsi installation

source $SNUGGSI/bin/.arguments

declare -rx \
  COMMAND="$SNUGGSI/bin/${@:-help}" # CLI snuggsi command to run from $SNUGGSI


run $COMMAND
