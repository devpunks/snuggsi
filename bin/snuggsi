#!/usr/bin/env bash

# Shell Parameter Expansion
#  - https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html

# Bash string manipulations
#  - http://www.tldp.org/LDP/LG/issue18/bash.html
#  - https://stackoverflow.com/questions/6393551/what-is-the-meaning-of-0-in-a-bash-script

echo
echo "  „ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ "
echo "  „ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ                  „ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ "
echo "  „ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ    snuggsi „ÉÑ    „ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ "
echo "  „ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ                  „ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ "
echo "  „ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ "
echo


# TODO: Remove global installation assumption.
#   This poses problems when installed locally.
declare -a  ARGS=( "${@:2}" ) # sanatize arguments
declare -r  BIN=`dirname $0` # local bin of current script
declare -ar RESOURCES=( "${ARGS[@]:- . }" ) # Default o curren directory
declare -r  ENTRY=${BIN}/${BASH_SOURCE##*/} # Current execution file name
declare -rx SNUGGSI=$(cd $BIN/`dirname ${ENTRY%/*}`; pwd)
declare -x  NODE_PATH=${NODE_PATH:-`npm config get prefix | awk NR==1`/lib/node_modules} # npm bin -g

echo BIN $BIN
echo RESOURCES ${#RESOURCES[@]} ${RESOURCES[@]}
echo ENTRY $ENTRY
echo dirname ENTRY `dirname $ENTRY`
echo NODE_PATH $NODE_PATH
ls $NODE_PATH
exit

# https://stackoverflow.com/questions/6393551/what-is-the-meaning-of-0-in-a-bash-script
declare -rx SNUGGSI=$(cd $BIN/`dirname ${ENTRY%/*}`; pwd)
declare -r  COMMAND="$SNUGGSI/bin/$1"

echo ARGS $ARGS
echo BASH SOURCE $BASH_SOURCE
echo readlink BASH SOURCE `readlink $BASH_SOURCE`
echo SNUGGSI $SNUGGSI
echo COMMAND $COMMAND


function execute {
  local executable=$(basename $COMMAND)

  echo

  if test ! -f $COMMAND || test $executable == snuggsi
    then
      echo "üî¥  Invalid command"
      echo
      exit 1
    fi

  echo "üìö  MOUNTING RESOURCES ‚Ä¶"
  printf '    üìÅ  %s\n' "${RESOURCES[@]}"
  echo

  for RESOURCE in ${RESOURCES[@]}
    do
      if test -d $RESOURCE
        then
          echo " üëâ  üìÇ  $RESOURCE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
          $COMMAND $RESOURCE
        else
          echo "üî¥  $RESOURCE NOT A DIRECTORY"
      fi
    done

  echo
}


execute $COMMAND
