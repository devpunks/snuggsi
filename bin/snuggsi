#!/usr/bin/env bash

# Environment variable vs. Shell Variable
#   - https://askubuntu.com/questions/26318/environment-variable-vs-shell-variable-whats-the-difference

# Shell Parameter Expansion
#  - https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html

# Bash string manipulations
#  - http://www.tldp.org/LDP/LG/issue18/bash.html
#  - https://stackoverflow.com/questions/6393551/what-is-the-meaning-of-0-in-a-bash-script

echo
echo "  ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ "
echo "  ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„                  ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ "
echo "  ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„    snuggsi ãƒ„    ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ "
echo "  ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„                  ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ "
echo "  ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ "
echo


# TODO: Remove global installation assumption.
#   This poses problems when installed locally.
declare -a  ARGS=( "${@:2}" ) # sanatize arguments
declare -r  BIN=`dirname $0` # local bin of current script
declare -ar RESOURCES=( "${ARGS[@]:-. }" ) # Default o curren directory
declare -r  ENTRY=${BIN}/${BASH_SOURCE##*/} # Current execution file name
declare -x  NODE_PATH=${NODE_PATH:-`npm config get prefix | awk NR==1`/lib/node_modules} # npm bin -g
declare -rx SNUGGSI=${NODE_PATH}/${BASH_SOURCE##*/} # Absolute path to snuggsi installation
declare -r  COMMAND="$SNUGGSI/bin/${1:-help}" # CLI snuggsi commandto run from $BIN

# echo ARGS $ARGS
# echo BIN $BIN
# echo RESOURCES ${#RESOURCES[@]} ${RESOURCES[@]}
# echo ENTRY $ENTRY
# echo dirname ENTRY `dirname $ENTRY`
# echo NODE_PATH $NODE_PATH
# echo SNUGGSI $SNUGGSI
# echo COMMAND $COMMAND

function execute {
  local executable=$1

  echo

  if test ${executable##*/} == snuggsi \
    || test ! -f $executable
      then
        echo "ğŸ”´  Invalid command \`${executable##*/}\`"
        ${executable%\/*}/help
        exit 1
    fi

  echo "ğŸ“š  MOUNTING RESOURCES â€¦"
  printf '    ğŸ“  %s\n' "${RESOURCES[@]}"
  echo

  for RESOURCE in ${RESOURCES[@]}
    do
      if test -d $RESOURCE
        then
          echo " ğŸ‘‰  ğŸ“‚  $RESOURCE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          $executable $RESOURCE
        else
          echo "ğŸ”´  $RESOURCE NOT A DIRECTORY"
      fi
    done

  echo
}

execute $COMMAND
