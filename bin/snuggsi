#!/usr/bin/env bash

set -u

echo '
  ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„
  ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„                  ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„
  ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„    snuggsi ãƒ„    ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„
  ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„                  ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„
  ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„
'

declare -x \
  COMMAND=$1 \
  NODE_PATH=${NODE_PATH:-`npm config get prefix | awk NR==1`/lib/node_modules} \
  SNUGGSI="${NODE_PATH}/${BASH_SOURCE##*/}"

function check () {
  local \
    resource=$1

    test ! -e "$resource" \
      && echo "  ğŸš«  RESOURCE NOT FOUND ğŸ‘‰ $resource\n\n" \
      && return 1

    return 0
} # check

function run () {
  local \
    snuggsi=$1
    command=${snuggsi}/bin/${2:-help}

  echo Local command ${command}
  echo Resources ${RESOURCES[@]}

  for resource in "${RESOURCES[@]}"
    do
      (check $resource) \
        && echo -e " ğŸ‘‰  ğŸ“‚  $resource â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n" \
        && $command $resource
    done
} # run

function snuggsi () {
  echo ${NODE_PATH}/${BASH_SOURCE##*/}
} # snuggsi

function command () {
  echo

  # test ! -f $execute \
  #   || test ${execute##*/} == snuggsi \
  #   && echo -e "\n  ğŸš«  NON EXECUTABLE COMMAND !\n\n" \
  #   && exit 1 # Short circuit execution

  # echo $execute
} # command

echo `type run `

source $SNUGGSI/bin/.resources

run $SNUGGSI $COMMAND
