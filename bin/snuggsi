#!/usr/bin/env bash

# Environment variable vs. Shell Variable
#  - https://askubuntu.com/questions/26318/environment-variable-vs-shell-variable-whats-the-difference

# Shell Parameter Expansion
#  - https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html

# Bash string manipulations
#  - http://www.tldp.org/LDP/LG/issue18/bash.html
#  - https://stackoverflow.com/questions/6393551/what-is-the-meaning-of-0-in-a-bash-script

echo "
  „ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ
  „ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ                  „ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ
  „ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ    snuggsi „ÉÑ    „ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ
  „ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ                  „ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ
  „ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ„ÉÑ
"

 # TODO: benchmark as node_path is rather slow due to npm
function node_path { # npm bin -g
  local \
    node=`npm config get prefix | awk NR==1` \
    modules=lib/node_modules

  echo $node/$modules
}


function check {
  local \
    resource=$1

    test ! -d $resource \
      && echo -e "  üî¥  $resource RESOURCE NOT FOUND !\n\n" \
      && return 1

    return 0
}

function run {
  local \
    command=$1

  source $1/bin/.arguments

  echo RUN 1 $1

  for resource in "${ARGUMENTS[@]:-`pwd` }" # Default to current directory
    do
      (check $resource) \
        && echo -e " üëâ  üìÇ  $resource ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n" \
        && $command $resource
    done
}

function snuggsi {
  local \
    SNUGGSI=${NODE_PATH}/${BASH_SOURCE##*/}

  echo $SNUGGSI
}


function command {
  echo SNUGGSI COMMAND $SNUGGSI

  local \
    execute=$1
    $SNUGGSI/bin/${@:-help}

# test ! -f $execute \
#   || test ${execute##*/} == snuggsi \
#   && echo -e "\n  üö´  NON EXECUTABLE COMMAND !\n\n" \
#   && exit 1 # Short circuit execution

# echo $execute
}


declare -rx  \
  COMMAND=$1 \
  NODE_PATH=${NODE_PATH:-`node_path`}

declare

echo SNUGGSI: `snuggsi`
echo COMMAND: `command`

# run `snuggsi`
