#!/usr/bin/env bash

set -u

clear ; echo '
  ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„
  ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„                  ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„
  ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„    snuggsi ãƒ„    ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„
  ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„                  ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„
  ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„ãƒ„
'
declare -x -r \
  COMMAND="${1:-help}" \
  PARAMS=${@:2} \
  SNUGGSI="${SNUGGSI:-$( npm config get prefix )/lib/node_modules/${BASH_SOURCE##*/}}"

echo SNUGGSI ğŸ‘‰ $SNUGGSI
printf "PARAM: %s\n" $PARAMS

function run () {
  local -r \
    command=$( te ${1} )

  echo COMMAND ğŸ‘‰ ${command}

  source $SNUGGSI/bin/.resources $PARAMS

  for resource in "${RESOURCES[@]}" ; do
    ( check $resource ) \
      && echo -e " ğŸ‘‰  ğŸ“‚  $resource â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n" \
      && $command $resource
  done
} # run

function te () {
  local -r \
    execute="${SNUGGSI}/bin/$1"

  test ! -f $execute \
    || test ${execute##*/} == snuggsi \
    && echo -e "\n  ğŸš«  NON EXECUTABLE COMMAND: ${execute}\n\n" \
    && exit 1 # Short circuit execution

  echo $execute
} # command

function check () {
  local \
    resource=$1

    test ! -e "$resource" \
      && echo "  ğŸš«  RESOURCE NOT FOUND ğŸ‘‰ $resource" \
      && return 1

    return 0
} # check

run $COMMAND
