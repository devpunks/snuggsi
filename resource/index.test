const
  path = '/foo/'
, URL  = `http://localhost:8181${path}`

, { test, read, fetch }
    = require ('test')

, { Server, Resource }
    = require ('..')

, route
    = require ('../middleware')
      .route  ( `${path}{id}`, Resource `server/fixtures` )

, METHODS = Array
    // HTTP Method Definitions
    // https://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html
    // MDN Request Methods
    // https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods
    .from ( require ('http').METHODS )

, SAFE_METHODS = ['OPTIONS', 'HEAD', 'GET']

, NONSAFE_METHODS = METHODS.filter
    (method => !!! SAFE_METHODS.includes (method))


test.only ('default allowed methods', async t => {
})


test ('new Resource', async t => {

  const
    method = 'TRACE'

  , endpoint =
      [ `${URL}14`, { method } ]

  , server =
      (new Server ( [ route ] ))
      .serve ``

  , response =
      await fetch ( ... endpoint )

  , { status, body } = response

  console.warn ('Resp', status, response.headers,  await response.text (), NONSAFE_METHODS, SAFE_METHODS)


  server.close ``
  t.end ()
})
