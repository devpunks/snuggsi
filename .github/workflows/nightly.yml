name: "Crank Snuggsi"
description: "Reusable action to crank snuggsi"

on:
  schedule: # https://en.wikipedia.org/wiki/Cron
    - cron: "30 * * * *" # Every Hour
  pull_request:
    paths:
      - ".github/workflows/nightly.yml"

permissions: # added using https://github.com/step-security/secure-workflows
  contents: read

jobs:
  linux:
    name: Linux
    runs-on: ubuntu-latest
    timeout-minutes: 10

    defaults:
      run:
        working-directory: src/github.com/devpunks/snuggsi

    steps:
      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
        with:
          path: src/github.com/devpunks/snuggsi

      - uses: ./src/github.com/devpunks/snuggsi/.github/actions/test.yml

      - name: Set env
        shell: bash
        run: |
          echo "BEFORE SHAZZZAAAM!"
          echo "${{ github.workspace }}" >> $GITHUB_ENV
          echo "${{ github.workspace }}/bin" >> $GITHUB_PATH
          echo "AFTER SHAZZZAAAM!"

      # Build
      - name: Install dependencies
        run: |
          sudo apt-get update || true
          sudo apt-get install -y \
            nodejs

      - name: Build amd64
        env:
          FOO: "foo env"
          BAR: "bar env"
        run: |
          echo "Foo: $FOO"
          echo "Bar: $BAR"

      # Upload
      - name: Upload artifacts (linux_amd64)
        uses: actions/upload-artifact@b4b15b8c7c6ac21ea08fcf65892d2ee8f75cf882 # v4.4.3
        with:
          name: linux_amd64
          path: src/github.com/containerd/containerd/bin_amd64

